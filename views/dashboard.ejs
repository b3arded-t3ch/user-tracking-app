<%- include('layout', { title: 'Dashboard' }) %>

<h1>Dashboard</h1>

<section>
	<h2>User List</h2>
	<table>
		<thead>
			<tr>
				<th><a href="?sort=username&order=<%= currentSort === 'username' && currentOrder === 1 ? 'desc' : 'asc' %>">Username</a></th>
				<th><a href="?sort=firstName&order=<%= currentSort === 'firstName' && currentOrder === 1 ? 'desc' : 'asc' %>">First Name</a></th>
				<th><a href="?sort=lastName&order=<%= currentSort === 'lastName' && currentOrder === 1 ? 'desc' : 'asc' %>">Last Name</a></th>
				<th><a href="?sort=organization&order=<%= currentSort === 'organization' && currentOrder === 1 ? 'desc' : 'asc' %>">Organization</a></th>
				<th><a href="?sort=country&order=<%= currentSort === 'country' && currentOrder === 1 ? 'desc' : 'asc' %>">Country</a></th>
				<th><a href="?sort=permissionLevel&order=<%= currentSort === 'permissionLevel' && currentOrder === 1 ? 'desc' : 'asc' %>">Permission Level</a></th>
				<th><a href="?sort=registrationDate&order=<%= currentSort === 'registrationDate' && currentOrder === 1 ? 'desc' : 'asc' %>">Registration Date</a></th>
				<th><a href="?sort=lastLoginDate&order=<%= currentSort === 'lastLoginDate' && currentOrder === 1 ? 'desc' : 'asc' %>">Last Login Date</a></th>
			</tr>
		</thead>
		<tbody>
			<% users.forEach(user => { %>
			<tr>
				<td><a href="/users/<%= user._id %>"><%= user.username %></a></td>
				<td><%= user.firstName %></td>
				<td><%= user.lastName %></td>
				<td><%= user.organization %></td>
				<td><%= user.country %></td>
				<td><%= user.permissionLevel %></td>
				<td><%= user.registrationDate.toLocaleDateString() %></td>
				<td><%= user.lastLoginDate ? user.lastLoginDate.toLocaleDateString() : 'N/A' %></td>
			</tr>
			<% }) %>
		</tbody>
	</table>
</section>

<section>
	<h2>Quick Stats</h2>
	<p>Total Users: <%= stats.totalUsers %></p>
	<p>Total Sites: <%= stats.totalSites %></p>
	<h3>Recent Activity</h3>
	<ul>
		<% stats.recentActivity.forEach(activity => { %>
			<li><%= activity.userId.username %> <%= activity.action %>ed <%= activity.siteId.name %> on <%= activity.date.toLocaleString() %></li><% }) %>
	</ul>
</section>

<nav>
	<a href="/sites">Manage Sites</a>
</nav>

<style>
	table { width: 100%; border-collapse: collapse; }
	th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
	th { background-color: #f2f2f2; }
	th a { text-decoration: none; color: #333; }
	th a:hover { text-decoration: underline; }
</style>
